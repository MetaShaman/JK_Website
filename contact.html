<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact - Joon Kim Land Stewardship</title>
    <meta name="description" content="Get in touch with Joon Kim to discuss your land stewardship and project management needs. Schedule a complimentary consultation.">
    <link rel="stylesheet" href="css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'GA_MEASUREMENT_ID');
    </script>

    <style>
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <a href="index.html">Joon Kim</a>
            </div>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="index.html" class="nav-link">Home</a>
                </li>
                <li class="nav-item">
                    <a href="services.html" class="nav-link">Services</a>
                </li>
                <li class="nav-item">
                    <a href="about.html" class="nav-link">About</a>
                </li>
                <li class="nav-item">
                    <a href="contact.html" class="nav-link active">Contact</a>
                </li>
            </ul>
            <div class="nav-toggle" id="mobile-menu">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </div>
        </div>
    </nav>

    <!-- Page Header -->
    <section class="page-header">
        <div class="container">
            <h1>Let's Connect</h1>
            <p>I'm eager to learn about your land and discuss how my services can help you achieve your goals. Please feel free to reach out using the contact information below, or fill out the form to schedule a complimentary consultation.</p>
        </div>
    </section>

    <!-- Contact Content -->
    <section class="contact-content">
        <div class="container">
            <div class="contact-grid">
                <!-- Contact Information -->
                <div class="contact-info">
                    <h2>Contact Information</h2>
                    <div class="contact-item">
                        <div class="contact-icon">
                            <i class="fas fa-envelope"></i>
                        </div>
                        <div class="contact-details">
                            <h3>Email</h3>
                            <p>ivanjoonkim@gmail.com</p>
                        </div>
                    </div>
                    <div class="contact-item">
                        <div class="contact-icon">
                            <i class="fas fa-map-marker-alt"></i>
                        </div>
                        <div class="contact-details">
                            <h3>Location</h3>
                            <p>315 Margarita Dr.<br>San Rafael, CA 94901</p>
                        </div>
                    </div>
                    
                    <!-- Service Areas -->
                    <div class="service-areas">
                        <h3>Service Areas</h3>
                        <p>Based in San Rafael, I primarily serve properties in Northern California, with extensive experience in:</p>
                        <ul>
                            <li>Marin County</li>
                            <li>Sonoma County</li>
                            <li>Napa County</li>
                            <li>San Francisco Bay Area</li>
                        </ul>
                        <p class="note">For properties outside these areas, please contact me to discuss availability.</p>
                    </div>
                </div>

                <!-- Contact Form -->
                <div class="contact-form">
                    <h2>Send Me a Message</h2>
                    <form id="contactForm" action="https://docs.google.com/forms/d/e/1FAIpQLSf76wgQZ6fUxB7f2Zt1Ppjw1hlQcoKqmk4Yn0O2R5Qmy9UHJA/formResponse" method="POST" target="_blank">
                        <div class="form-group">
                            <label for="email">Email *</label>
                            <input type="email" id="email" name="emailAddress" required>
                        </div>
                        <div class="form-group">
                            <label for="landLove">What is one thing that you love about your land?</label>
                            <input type="text" id="landLove" name="entry.428724634" placeholder="Tell me about your favorite aspect of your land">
                        </div>
                        <div class="form-group">
                            <label for="name">Full Name *</label>
                            <input type="text" id="name" name="entry.641543091" required>
                        </div>
                        <div class="form-group">
                            <label for="phone">Phone Number</label>
                            <input type="tel" id="phone" name="entry.1764103006">
                        </div>
                        <div class="form-group">
                            <label for="property-location">Land Location</label>
                            <input type="text" id="property-location" name="entry.1531760759" placeholder="City, State">
                        </div>
                        <div class="form-group">
                            <label for="property-size">Land Size</label>
                            <select id="property-size" name="entry.789863818">
                                <option value="">Select land size</option>
                                <option value="Under 1 acre">Under 1 acre</option>
                                <option value="1-5 acres">1-5 acres</option>
                                <option value="5-10 acres">5-10 acres</option>
                                <option value="10+ acres">10+ acres</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="services-interest">Services of Interest</label>
                            <div class="checkbox-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" name="entry.911095196" value="Structural Repairs & Maintenance">
                                    Structural Repairs & Maintenance
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="entry.911095196" value="Landscape & Garden Projects">
                                    Landscape & Garden Projects
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="entry.911095196" value="Design Support & Implementation">
                                    Design Support & Implementation
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="entry.911095196" value="Project Tracking & Oversight">
                                    Project Tracking & Oversight
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="entry.911095196" value="Regulatory Compliance & Permitting">
                                    Regulatory Compliance & Permitting
                                </label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="timeline">Project Timeline</label>
                            <select id="timeline" name="entry.847273278">
                                <option value="">Select timeline</option>
                                <option value="Immediate (within 1 month)">Immediate (within 1 month)</option>
                                <option value="Short-term (1-3 months)">Short-term (1-3 months)</option>
                                <option value="Medium-term (3-6 months)">Medium-term (3-6 months)</option>
                                <option value="Long-term (6+ months)">Long-term (6+ months)</option>
                                <option value="Ongoing stewardship">Ongoing stewardship</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="message">Current Challenges and Goals *</label>
                            <textarea id="message" name="entry.771214362" rows="5" placeholder="Please describe your current land challenges and goals." required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="contact-method">Preferred Contact Method *</label>
                            <select id="contact-method" name="entry.2117189622" required>
                                <option value="">Select contact method</option>
                                <option value="Email">Email</option>
                                <option value="Phone Call">Phone Call</option>
                                <option value="Video call (Zoom/Google Meet)">Video call (Zoom/Google Meet)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="best-time">Best Time to Contact</label>
                            <select id="best-time" name="entry.2015429434">
                                <option value="">Select best time</option>
                                <option value="Morning (9 AM - 12 PM)">Morning (9 AM - 12 PM)</option>
                                <option value="Afternoon (12 PM - 5 PM)">Afternoon (12 PM - 5 PM)</option>
                                <option value="Evening (5 PM - 8 PM)">Evening (5 PM - 8 PM)</option>
                            </select>
                        </div>
                        
                        <!-- Consultation Preference Section -->
                        <div class="form-group">
                            <label class="form-label-required">Consultation Preference *</label>
                            <div class="radio-group">
                                <label class="radio-option">
                                    <input type="radio" name="consultationType" value="discovery_call" required>
                                    <span class="radio-custom"></span>
                                    Schedule a 15 minute discovery call
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="consultationType" value="email_only" required>
                                    <span class="radio-custom"></span>
                                    Not ready to book a call now
                                </label>
                            </div>
                            <small class="form-help-text">üí° Discovery calls help us better understand your specific needs and provide tailored recommendations.</small>
                        </div>
                        
                        <!-- Calendly Widget Container (hidden by default) -->
                        <div id="calendly-container" class="calendly-container" style="display: none;">
                            <div class="calendly-header">
                                <h3>üìÖ Schedule Your 15-Minute Discovery Call</h3>
                                <p>Choose a time that works best for you. This will be a 15-minute complimentary discovery call to discuss your land stewardship needs and goals.</p>
                                <div class="calendly-instructions">
                                    <div class="instruction-step">
                                        <span class="step-number">1</span>
                                        <span>Fill out the form above with your project details</span>
                                    </div>
                                    <div class="instruction-step">
                                        <span class="step-number">2</span>
                                        <span>Schedule your discovery call below</span>
                                    </div>
                                    <div class="instruction-step">
                                        <span class="step-number">3</span>
                                        <span>Submit the form to send your information</span>
                                    </div>
                                </div>
                            </div>
                            <div class="calendly-inline-widget" data-url="https://calendly.com/joonkimland/discovery-call" style="min-width:320px;height:700px;"></div>
                            <div id="call-scheduled-status" class="call-status" style="display: none;">
                                <div class="status-success">
                                    <i class="fas fa-check-circle"></i>
                                    <span>‚úÖ Discovery call scheduled successfully!</span>
                                </div>
                            </div>
                            <!-- Manual trigger for testing -->
                            <div style="text-align: center; margin-top: 15px;">
                                <button type="button" class="btn btn-info btn-sm" onclick="markCallAsScheduled({ source: 'manual test' })">
                                    üîß Test: Simulate Booking Detection
                                </button>
                                <small style="display: block; margin-top: 5px; color: #6c757d;">
                                    Use this button to test if booking detection works
                                </small>
                            </div>
                        </div>
                        
                        <!-- Hidden field to track call scheduling -->
                        <input type="hidden" id="call-scheduled" name="callScheduled" value="false">
                        
                        <!-- Hidden fields for Calendly booking data -->
                        <input type="hidden" id="appointment-booked" name="entry.905794834" value="No">
                        <input type="hidden" id="appointment-type" name="entry.1099853613" value="">
                        <input type="hidden" id="appointment-date" name="entry.507706455" value="">
                        <input type="hidden" id="appointment-time" name="entry.836387002" value="">
                        <input type="hidden" id="appointment-info" name="entry.1480507405" value="">
                        
                        <button type="submit" class="btn btn-primary">Send Message</button>
                        
                        <!-- Debug button for testing -->
                        <button type="button" class="btn btn-secondary" style="margin-left: 10px; font-size: 12px;" onclick="simulateCallScheduled()">Test: Simulate Call Scheduled</button>
                        <button type="button" class="btn btn-secondary" style="margin-left: 10px; font-size: 12px;" onclick="testCalendlyListener()">Test: Check Calendly</button>
                        <button type="button" class="btn btn-secondary" style="margin-left: 10px; font-size: 12px;" onclick="manualBookingComplete()">Manual: Set Booking State</button>

                        <!-- Manual trigger button for testing
                        <button type="button" class="btn btn-warning btn-sm" onclick="markCallAsScheduled({ source: 'manual test' })">üîß Test: Simulate Call Booking</button> -->
                    </form>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Joon Kim</h3>
                    <p>Land Stewardship & Project Management</p>
                    <p>San Rafael, CA</p>
                </div>
                <div class="footer-section">
                    <h4>Services</h4>
                    <ul>
                        <li><a href="services.html">Building & Infrastructure</a></li>
                        <li><a href="services.html">Land & Garden Projects</a></li>
                        <li><a href="services.html">Design & Implementation</a></li>
                        <li><a href="services.html">Oversight & Compliance</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Contact</h4>
                    <p><i class="fas fa-envelope"></i> ivanjoonkim@gmail.com</p>
                    <p><i class="fas fa-map-marker-alt"></i> 315 Margarita Dr., San Rafael, CA 94901</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 Joon Kim. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Calendly Integration -->
    <script type="text/javascript" src="https://assets.calendly.com/assets/external/widget.js" async></script>
    <script>
        // Page identifier
        console.log('üìç Loading contact.html - Main contact page');
        
        // Calendly integration
        let callScheduled = false;
        let calendlyReady = false;
        let calendlyWidget = null;

        // Initialize Calendly with better error handling and longer timeout
        function initializeCalendly() {
            console.log('üîÑ Initializing Calendly...');
            
            // Wait for Calendly to be available
            let attempts = 0;
            const maxAttempts = 50; // Increased from 20 to 50 (5 seconds)
            
            const checkCalendly = setInterval(() => {
                attempts++;
                console.log(`üîÑ Calendly check attempt ${attempts}/${maxAttempts}`);
                
                if (window.Calendly && typeof window.Calendly.initInlineWidget === 'function') {
                    clearInterval(checkCalendly);
                    console.log('‚úÖ Calendly is ready');
                    calendlyReady = true;
                    
                    // Initialize the widget
                    try {
                        calendlyWidget = window.Calendly.initInlineWidget({
                            url: 'https://calendly.com/joonkimland/discovery-call',
                            parentElement: document.getElementById('calendly-widget'),
                            prefill: {},
                            utm: {}
                        });
                        console.log('‚úÖ Calendly widget initialized');
                        
                        // Set up event listeners after widget is ready
                        setTimeout(setupCalendlyEventListeners, 1000);
                        
                    } catch (error) {
                        console.error('‚ùå Error initializing Calendly widget:', error);
                    }
                    
                } else if (attempts >= maxAttempts) {
                    clearInterval(checkCalendly);
                    console.error('‚ùå Calendly failed to load within timeout');
                    document.getElementById('calendly-status').textContent = 'Calendly failed to load. Please refresh the page.';
                }
            }, 100);
        }

        // Set up Calendly event listeners with multiple approaches
        function setupCalendlyEventListeners() {
            console.log('üéß Setting up Calendly event listeners...');
            
            // Method 1: Listen for Calendly events on the document
            document.addEventListener('calendly:event_scheduled', function(e) {
                console.log('üéâ Calendly event scheduled:', e.detail);
                handleCallScheduled(e.detail);
            });
            
            document.addEventListener('calendly:event_type_viewed', function(e) {
                console.log('üëÅÔ∏è Calendly event type viewed:', e.detail);
            });
            
            document.addEventListener('calendly:profile_page_viewed', function(e) {
                console.log('üë§ Calendly profile viewed:', e.detail);
            });
            
            // Method 2: Listen for iframe messages
            window.addEventListener('message', function(e) {
                if (e.data && e.data.event && e.data.event.indexOf('calendly') !== -1) {
                    console.log('üì® Calendly message received:', e.data);
                    if (e.data.event === 'calendly:event_scheduled') {
                        handleCallScheduled(e.data.payload);
                    }
                }
            });
            
            // Method 3: Monitor the widget iframe directly
            const widgetElement = document.getElementById('calendly-widget');
            if (widgetElement) {
                const observer = new MutationObserver(function(mutations) {
                    mutations.forEach(function(mutation) {
                        if (mutation.type === 'childList') {
                            const iframe = widgetElement.querySelector('iframe');
                            if (iframe) {
                                console.log('üñºÔ∏è Calendly iframe detected');
                                // Listen for iframe load events
                                iframe.addEventListener('load', function() {
                                    console.log('üñºÔ∏è Calendly iframe loaded');
                                });
                            }
                        }
                    });
                });
                
                observer.observe(widgetElement, { childList: true, subtree: true });
            }
            
            // Method 4: Monitor form fields for changes (fallback)
            monitorCallScheduledField();
        }

        // Handle call scheduled event
        function handleCallScheduled(details) {
            console.log('üéâ Call scheduled with details:', details);
            callScheduled = true;
            
            // Update hidden fields with booking information
            if (details) {
                document.getElementById('entry_booking_booked').value = 'Yes';
                document.getElementById('entry_booking_appointment_type').value = 'Discovery Call';
                document.getElementById('entry_booking_date_time').value = details.startTime || 'Scheduled';
                document.getElementById('entry_booking_info').value = JSON.stringify(details);
            }
            
            // Update UI
            updateCallStatus();
            enableFormSubmission();
        }

        // Monitor the call-scheduled field for changes (fallback method)
        function monitorCallScheduledField() {
            console.log('üëÅÔ∏è Monitoring call-scheduled field for changes');
            
            const field = document.getElementById('call-scheduled');
            if (field) {
                const observer = new MutationObserver(function(mutations) {
                    mutations.forEach(function(mutation) {
                        if (mutation.type === 'attributes' && mutation.attributeName === 'value') {
                            const value = field.value;
                            console.log('üìù Call-scheduled field changed to:', value);
                            if (value === 'true' || value === '1') {
                                handleCallScheduled({ startTime: 'Scheduled via field change' });
                            }
                        }
                    });
                });
                
                observer.observe(field, { attributes: true, attributeFilter: ['value'] });
            }
        }

        // Update call status in UI
        function updateCallStatus() {
            console.log('üéâ Updating call status - call scheduled!');
            
            const callScheduledStatus = document.getElementById('call-scheduled-status');
            if (callScheduledStatus) {
                callScheduledStatus.style.display = 'block';
                callScheduledStatus.scrollIntoView({ behavior: 'smooth', block: 'center' });
                
                // Clear any existing messages
                callScheduledStatus.innerHTML = '';
                
                // Show prominent success message
                const successMessage = document.createElement('div');
                successMessage.className = 'alert alert-success';
                successMessage.style.cssText = `
                    background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
                    border: 2px solid #28a745;
                    border-radius: 10px;
                    padding: 20px;
                    margin: 15px 0;
                    text-align: center;
                    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
                `;
                successMessage.innerHTML = `
                    <div style="font-size: 24px; margin-bottom: 10px;">üéâ</div>
                    <h4 style="color: #155724; margin-bottom: 10px; font-weight: bold;">Call Successfully Booked!</h4>
                    <p style="color: #155724; margin-bottom: 15px; font-size: 16px;">
                        Your 15-minute discovery call has been scheduled. You'll receive a confirmation email shortly.
                    </p>
                    <div style="background: #fff; padding: 15px; border-radius: 8px; border: 1px solid #28a745; margin: 10px 0;">
                        <strong style="color: #155724;">‚úÖ Form is now unlocked</strong><br>
                        <small style="color: #6c757d;">You can now submit your project details below</small>
                    </div>
                `;
                callScheduledStatus.appendChild(successMessage);
                
                // Add a subtle animation
                successMessage.style.animation = 'fadeInUp 0.5s ease-out';
            }
        }

        // Enable form submission
        function enableFormSubmission() {
            console.log('‚úÖ Enabling form submission');
            const submitButton = document.querySelector('#contactForm button[type="submit"]');
            if (submitButton) {
                submitButton.disabled = false;
                submitButton.textContent = 'Submit Project Details';
                submitButton.style.opacity = '1';
                submitButton.style.cursor = 'pointer';
            }
        }

        // Test function to simulate call scheduling (for debugging)
        function simulateCallScheduled() {
            console.log('üß™ Simulating call scheduled');
            handleCallScheduled({ startTime: 'Test simulation' });
        }

        // Start Calendly initialization
        initializeCalendly();

        // Form submission handling
        document.addEventListener('DOMContentLoaded', function() {
            const contactForm = document.getElementById('contactForm');
            const discoveryCallRadio = document.querySelector('input[value="discovery_call"]');
            const emailOnlyRadio = document.querySelector('input[value="email_only"]');
            const calendlyContainer = document.getElementById('calendly-container');
            
            // Function to handle radio button changes
            function handleConsultationPreference() {
                if (discoveryCallRadio.checked) {
                    console.log('üìÖ Discovery call selected - showing Calendly widget');
                    calendlyContainer.style.display = 'block';
                    calendlyContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });
                } else if (emailOnlyRadio.checked) {
                    console.log('üìß Email only selected - hiding Calendly widget');
                    calendlyContainer.style.display = 'none';
                }
            }
            
            // Add event listeners to radio buttons
            if (discoveryCallRadio) {
                discoveryCallRadio.addEventListener('change', handleConsultationPreference);
            }
            if (emailOnlyRadio) {
                emailOnlyRadio.addEventListener('change', handleConsultationPreference);
            }
            
            // Check initial state
            handleConsultationPreference();
            
            // Form submission blocking
            if (contactForm) {
                contactForm.addEventListener('submit', function(e) {
                    const isDiscoveryCallSelected = discoveryCallRadio && discoveryCallRadio.checked;
                    
                    console.log('üìù Form submission attempt:');
                    console.log('- Discovery call selected:', isDiscoveryCallSelected);
                    console.log('- Call scheduled:', callScheduled);
                    
                    if (isDiscoveryCallSelected && !callScheduled) {
                        e.preventDefault();
                        console.log('‚ùå Form submission blocked - call not scheduled');
                        
                        // Show blocking message
                        const blockingMessage = document.createElement('div');
                        blockingMessage.className = 'alert alert-warning';
                        blockingMessage.style.cssText = `
                            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
                            border: 2px solid #ffc107;
                            border-radius: 10px;
                            padding: 15px;
                            margin: 15px 0;
                            text-align: center;
                        `;
                        blockingMessage.innerHTML = `
                            <strong style="color: #856404;">‚ö†Ô∏è Please Schedule Your Call First</strong><br>
                            <small style="color: #856404;">You selected a discovery call but haven't scheduled it yet. Please complete your booking above before submitting the form.</small>
                        `;
                        
                        // Insert message before the form
                        contactForm.parentNode.insertBefore(blockingMessage, contactForm);
                        
                        // Scroll to the message
                        blockingMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        
                        // Remove message after 5 seconds
                        setTimeout(function() {
                            if (blockingMessage.parentNode) {
                                blockingMessage.parentNode.removeChild(blockingMessage);
                            }
                        }, 5000);
                        
                        return false;
                    } else {
                        console.log('‚úÖ Form submission allowed');
                        return true;
                    }
                });
            }
        });
    </script>
</body>
</html>

