<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Contact Form</title>
    <link rel="stylesheet" href="css/styles.css">
    <style>
        .test-header {
            background: #2d5a27;
            color: white;
            padding: 20px;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-controls {
            background: #f8f9fa;
            border: 2px solid #2d5a27;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
            text-align: center;
        }
        .test-controls button {
            background: #2d5a27;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            margin: 0 10px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="test-header">
        <h1>üß™ Contact Form Test Page</h1>
        <p>Auto-populated with demo data for testing</p>
    </div>

    <div class="container">
        <div class="test-controls">
            <button onclick="populateDemoData()">üìù Populate Demo Data</button>
            <button onclick="clearForm()">üóëÔ∏è Clear Form</button>
            <button onclick="testEmailOnly()">üìß Test Email-Only</button>
            <button onclick="testCallScheduling()">üìÖ Test Call Scheduling</button>
            <button onclick="simulateCallScheduled()">üéØ Simulate Call Scheduled</button>
            <button onclick="testDirectSubmission()">üöÄ Test Direct Submission</button>
        </div>

        <!-- Copy the entire contact form from contact.html here -->
        <div class="contact-form">
            <h2>Send Me a Message</h2>
            <form id="contactForm" action="https://docs.google.com/forms/d/e/1FAIpQLSf76wgQZ6fUxB7f2Zt1Ppjw1hlQcoKqmk4Yn0O2R5Qmy9UHJA/formResponse" method="POST" target="hidden_iframe">
                <div class="form-group">
                    <label for="name">Full Name *</label>
                    <input type="text" id="name" name="entry.641543091" required>
                </div>
                <div class="form-group">
                    <label for="email">Email Address *</label>
                    <input type="email" id="email" name="emailAddress" required>
                </div>
                <div class="form-group">
                    <label for="phone">Phone Number</label>
                    <input type="tel" id="phone" name="entry.1764103006">
                </div>
                <div class="form-group">
                    <label for="landLove">What is one thing that you love about your land?</label>
                    <input type="text" id="landLove" name="entry.428724634" placeholder="Tell me about your favorite aspect of your land">
                </div>
                <div class="form-group">
                    <label for="property-location">Land Location</label>
                    <input type="text" id="property-location" name="entry.1531760759" placeholder="City, State">
                </div>
                <div class="form-group">
                    <label for="property-size">Land Size</label>
                    <select id="property-size" name="entry.789863818">
                        <option value="">Select land size</option>
                        <option value="Under 1 acre">Under 1 acre</option>
                        <option value="1-5 acres">1-5 acres</option>
                        <option value="5-10 acres">5-10 acres</option>
                        <option value="10+ acres">10+ acres</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="services-interest">Services of Interest</label>
                    <div class="checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" name="entry.911095196" value="Structural Repairs & Maintenance">
                            Structural Repairs & Maintenance
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="entry.911095196" value="Landscape & Garden Projects">
                            Landscape & Garden Projects
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="entry.911095196" value="Design Support & Implementation">
                            Design Support & Implementation
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="entry.911095196" value="Project Tracking & Oversight">
                            Project Tracking & Oversight
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="entry.911095196" value="Regulatory Compliance & Permitting">
                            Regulatory Compliance & Permitting
                        </label>
                    </div>
                </div>
                <div class="form-group">
                    <label for="timeline">Project Timeline</label>
                    <select id="timeline" name="entry.847273278">
                        <option value="">Select timeline</option>
                        <option value="Immediate (within 1 month)">Immediate (within 1 month)</option>
                        <option value="Short-term (1-3 months)">Short-term (1-3 months)</option>
                        <option value="Medium-term (3-6 months)">Medium-term (3-6 months)</option>
                        <option value="Long-term (6+ months)">Long-term (6+ months)</option>
                        <option value="Ongoing stewardship">Ongoing stewardship</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="message">Current Challenges and Goals *</label>
                    <textarea id="message" name="entry.771214362" rows="5" placeholder="Please describe your current land challenges and goals." required></textarea>
                </div>
                <div class="form-group">
                    <label for="contact-method">Preferred Contact Method *</label>
                    <select id="contact-method" name="entry.2117189622" required>
                        <option value="">Select contact method</option>
                        <option value="Email">Email</option>
                        <option value="Phone Call">Phone Call</option>
                        <option value="Video call (Zoom/Google Meet)">Video call (Zoom/Google Meet)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="best-time">Best Time to Contact</label>
                    <select id="best-time" name="entry.2015429434">
                        <option value="">Select best time</option>
                        <option value="Morning (9 AM - 12 PM)">Morning (9 AM - 12 PM)</option>
                        <option value="Afternoon (12 PM - 5 PM)">Afternoon (12 PM - 5 PM)</option>
                        <option value="Evening (5 PM - 8 PM)">Evening (5 PM - 8 PM)</option>
                    </select>
                </div>
                
                <!-- Consultation Preference Section -->
                <div class="form-group">
                    <label class="form-label-required">Consultation Preference *</label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="consultationPreference" value="schedule-call" id="schedule-call" required>
                            <span class="radio-custom"></span>
                            <div class="radio-content">
                                <span class="radio-title">üìÖ Schedule a 15-Minute Discovery Call</span>
                                <span class="radio-description">I'd like to schedule a 15-minute complimentary discovery call to discuss my land stewardship needs (recommended for new clients)</span>
                            </div>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="consultationPreference" value="not-ready" id="not-ready" required>
                            <span class="radio-custom"></span>
                            <div class="radio-content">
                                <span class="radio-title">üìß Email Communication Only</span>
                                <span class="radio-description">I'm not ready to schedule a call today, but would like to receive information via email</span>
                            </div>
                        </label>
                    </div>
                    <small class="form-help-text">üí° Discovery calls help us better understand your specific needs and provide tailored recommendations.</small>
                </div>
                
                <!-- Calendly Widget Container (hidden by default) -->
                <div id="calendly-container" class="calendly-container" style="display: none;">
                    <div class="calendly-header">
                        <h3>üìÖ Schedule Your 15-Minute Discovery Call</h3>
                        <p>Choose a time that works best for you. This will be a 15-minute complimentary discovery call to discuss your land stewardship needs and goals.</p>
                        <div class="calendly-instructions">
                            <div class="instruction-step">
                                <span class="step-number">1</span>
                                <span>Fill out the form above with your project details</span>
                            </div>
                            <div class="instruction-step">
                                <span class="step-number">2</span>
                                <span>Schedule your discovery call below</span>
                            </div>
                            <div class="instruction-step">
                                <span class="step-number">3</span>
                                <span>Submit the form to send your information</span>
                            </div>
                        </div>
                    </div>
                    <div class="calendly-inline-widget" data-url="https://calendly.com/joonkim_schedule/land-stewardship-discovery-call?prefill[email]=&prefill[name]=&prefill[first_name]=&prefill[last_name]=&prefill[phone]=&prefill[location]=&prefill[note]=" style="min-width:320px;height:700px;"></div>
                    <div id="call-scheduled-status" class="call-status" style="display: none;">
                        <div class="status-success">
                            <i class="fas fa-check-circle"></i>
                            <span>‚úÖ Discovery call scheduled successfully!</span>
                        </div>
                    </div>
                </div>
                
                <!-- Hidden field to track call scheduling -->
                <input type="hidden" id="call-scheduled" name="callScheduled" value="false">
                
                <!-- Hidden fields for Calendly booking data -->
                <input type="hidden" id="appointment-booked" name="entry.696501216" value="No">
                <input type="hidden" id="appointment-type" name="entry.789467207" value="">
                <input type="hidden" id="appointment-date" name="entry.1891353278" value="">
                <input type="hidden" id="appointment-time" name="entry.1771796759" value="">
                <input type="hidden" id="appointment-info" name="entry.799991557" value="">
                
                <button type="submit" class="btn btn-primary">Send Message</button>
            </form>
            <iframe name="hidden_iframe" id="hidden_iframe" style="display:none;" onload="console.log('üì® Form submitted to Google Forms!')"></iframe>
        </div>
    </div>

    <!-- Calendly Integration -->
    <script type="text/javascript" src="https://assets.calendly.com/assets/external/widget.js" async></script>
    <script>
        // Demo data
        const demoData = {
            email: 'test@example.com',
            landLove: 'The beautiful oak trees and rolling hills',
            name: 'John Smith',
            phone: '(555) 123-4567',
            propertyLocation: 'Napa, CA',
            propertySize: '5-10 acres',
            services: ['Structural Repairs & Maintenance', 'Landscape & Garden Projects'],
            timeline: 'Short-term (1-3 months)',
            message: 'We have a beautiful 8-acre property in Napa Valley that needs some TLC. The main house needs structural repairs, and we\'d like to create a sustainable garden.',
            contactMethod: 'Video call (Zoom/Google Meet)',
            bestTime: 'Afternoon (12 PM - 5 PM)'
        };

        function populateDemoData() {
            document.getElementById('email').value = demoData.email;
            document.getElementById('landLove').value = demoData.landLove;
            document.getElementById('name').value = demoData.name;
            document.getElementById('phone').value = demoData.phone;
            document.getElementById('property-location').value = demoData.propertyLocation;
            document.getElementById('property-size').value = demoData.propertySize;
            
            // Check services
            demoData.services.forEach(service => {
                const checkboxes = document.querySelectorAll('input[name="entry.911095196"]');
                checkboxes.forEach(checkbox => {
                    if (checkbox.value === service) {
                        checkbox.checked = true;
                    }
                });
            });
            
            document.getElementById('timeline').value = demoData.timeline;
            document.getElementById('message').value = demoData.message;
            document.getElementById('contact-method').value = demoData.contactMethod;
            document.getElementById('best-time').value = demoData.bestTime;
            
            console.log('‚úÖ Demo data populated!');
        }

        function clearForm() {
            document.getElementById('contactForm').reset();
            document.getElementById('calendly-container').style.display = 'none';
            document.getElementById('call-scheduled-status').style.display = 'none';
            document.getElementById('call-scheduled').value = 'false';
            console.log('üóëÔ∏è Form cleared!');
        }

        function testEmailOnly() {
            populateDemoData();
            document.getElementById('not-ready').checked = true;
            document.getElementById('calendly-container').style.display = 'none';
            console.log('üìß Email-only flow ready for testing!');
        }

        function testCallScheduling() {
            populateDemoData();
            document.getElementById('schedule-call').checked = true;
            document.getElementById('calendly-container').style.display = 'block';
            console.log('üìÖ Call scheduling flow ready for testing!');
        }

        function simulateCallScheduled() {
            populateDemoData();
            document.getElementById('schedule-call').checked = true;
            document.getElementById('calendly-container').style.display = 'block';
            
            // Manually trigger the call scheduled state
            const callScheduledField = document.getElementById('call-scheduled');
            const callScheduledStatus = document.getElementById('call-scheduled-status');
            
            callScheduledField.value = 'true';
            callScheduledStatus.style.display = 'block';
            
            // Populate appointment fields
            const appointmentBooked = document.getElementById('appointment-booked');
            const appointmentType = document.getElementById('appointment-type');
            const appointmentDate = document.getElementById('appointment-date');
            const appointmentTime = document.getElementById('appointment-time');
            const appointmentInfo = document.getElementById('appointment-info');
            
            if (appointmentBooked) appointmentBooked.value = 'Yes';
            if (appointmentType) appointmentType.value = 'Land Stewardship Discovery Call';
            if (appointmentDate) appointmentDate.value = 'Monday, July 1, 2024';
            if (appointmentTime) appointmentTime.value = '2:00 PM PDT';
            if (appointmentInfo) appointmentInfo.value = 'Event: Land Stewardship Discovery Call | Duration: 15 minutes | Location: Zoom';
            
            console.log('üéØ Simulated call scheduled - all fields populated');
        }

        function testDirectSubmission() {
            populateDemoData();
            document.getElementById('not-ready').checked = true;
            
            // Temporarily remove the submit event listener
            const form = document.getElementById('contactForm');
            const originalSubmit = form.onsubmit;
            form.onsubmit = null;
            
            console.log('üöÄ Testing direct form submission to Google Forms...');
            console.log('üìä Form action:', form.action);
            console.log('üìä Form method:', form.method);
            console.log('üìä Form target:', form.target);
            
            // Submit the form directly
            form.submit();
            
            // Restore the original submit handler after a delay
            setTimeout(() => {
                form.onsubmit = originalSubmit;
                console.log('‚úÖ Submit handler restored');
            }, 3000);
        }

        // Auto-populate on page load
        document.addEventListener('DOMContentLoaded', function() {
            populateDemoData();
            console.log('üìù Demo data populated');
            
            // Start checking for Calendly
            checkCalendlyLoaded();
        });

        // Copy the JavaScript from contact.html here
        document.addEventListener('DOMContentLoaded', function() {
            const scheduleCallRadio = document.getElementById('schedule-call');
            const notReadyRadio = document.getElementById('not-ready');
            const calendlyContainer = document.getElementById('calendly-container');
            const contactForm = document.getElementById('contactForm');
            const callScheduledField = document.getElementById('call-scheduled');
            const callScheduledStatus = document.getElementById('call-scheduled-status');
            
            function handleConsultationPreference() {
                if (scheduleCallRadio && scheduleCallRadio.checked) {
                    calendlyContainer.style.display = 'block';
                    callScheduledField.value = 'false';
                    callScheduledStatus.style.display = 'none';
                    calendlyContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
                } else {
                    calendlyContainer.style.display = 'none';
                    callScheduledField.value = 'false';
                    callScheduledStatus.style.display = 'none';
                }
            }
            
            if (scheduleCallRadio) {
                scheduleCallRadio.addEventListener('change', handleConsultationPreference);
            }
            if (notReadyRadio) {
                notReadyRadio.addEventListener('change', handleConsultationPreference);
            }
            
            // Initialize Calendly listener when ready
            checkCalendlyLoaded();
            
            if (contactForm) {
                contactForm.addEventListener('submit', function(e) {
                    console.log('üìù Form submission started');
                    
                    const isSchedulingSelected = scheduleCallRadio && scheduleCallRadio.checked;
                    const isCallScheduled = callScheduledField.value === 'true';
                    
                    console.log('üìä Form state:', {
                        isSchedulingSelected: isSchedulingSelected,
                        isCallScheduled: isCallScheduled,
                        callScheduledFieldValue: callScheduledField.value
                    });
                    
                    if (isSchedulingSelected && !isCallScheduled) {
                        e.preventDefault();
                        console.log('‚ùå Form submission blocked - call not scheduled');
                        alert('‚ö†Ô∏è Please schedule your discovery call before submitting the form.\n\nYou selected to schedule a call, but no call has been scheduled yet. Please complete your booking in the calendar above, then try submitting again.');
                        calendlyContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        return false;
                    }
                    
                    let confirmMessage = 'Ready to submit your information?';
                    if (isSchedulingSelected && isCallScheduled) {
                        confirmMessage = 'Perfect! You\'ve scheduled your discovery call and filled out the form. Ready to submit?\n\nClick OK to send your information, or Cancel to review.';
                    }
                    
                    const shouldSubmit = confirm(confirmMessage);
                    console.log('‚úÖ User confirmed submission:', shouldSubmit);
                    
                    if (!shouldSubmit) {
                        e.preventDefault();
                        console.log('‚ùå User cancelled submission');
                        return false;
                    }
                    
                    console.log('üöÄ Form submission proceeding to Google Forms...');
                    
                    // Let the form submit normally to Google Forms
                    // The iframe will handle the submission
                    // Don't prevent default - let the form submit!
                    
                    setTimeout(function() {
                        showSubmissionSuccess();
                    }, 2000); // Give more time for the form to submit
                });
            }
            
            function showSubmissionSuccess() {
                const contactFormContainer = document.querySelector('.contact-form');
                const isSchedulingSelected = scheduleCallRadio && scheduleCallRadio.checked;
                
                let successMessage = `
                    <div class="submission-success">
                        <div class="success-content">
                            <i class="fas fa-check-circle"></i>
                            <h2>Thank You!</h2>
                            <p>Your message has been sent successfully. I'll get back to you within 24 hours.</p>
                        </div>
                    </div>
                `;
                
                if (isSchedulingSelected) {
                    successMessage = `
                        <div class="submission-success">
                            <div class="success-content">
                                <i class="fas fa-check-circle"></i>
                                <h2>Thank You!</h2>
                                <p>Your message has been sent and your discovery call has been scheduled. I'll send you a confirmation email with the call details.</p>
                                <p>I look forward to discussing your land stewardship needs!</p>
                            </div>
                        </div>
                    `;
                }
                
                contactFormContainer.innerHTML = successMessage;
            }
        });

        // Check if Calendly is loaded
        function checkCalendlyLoaded() {
            if (window.Calendly) {
                console.log('‚úÖ Calendly is loaded and ready');
                initCalendlyListener();
                return true;
            } else {
                console.log('‚ö†Ô∏è Calendly not loaded yet, retrying in 1 second...');
                setTimeout(checkCalendlyLoaded, 1000);
                return false;
            }
        }
        
        // Initialize Calendly event listener when ready
        function initCalendlyListener() {
            if (window.Calendly) {
                window.Calendly('onEventScheduled', function(e) {
                    console.log('üéâ Calendly event scheduled:', e);
                    
                    const appointmentBooked = document.getElementById('appointment-booked');
                    const appointmentType = document.getElementById('appointment-type');
                    const appointmentDate = document.getElementById('appointment-date');
                    const appointmentTime = document.getElementById('appointment-time');
                    const appointmentInfo = document.getElementById('appointment-info');
                    
                    if (appointmentBooked) {
                        appointmentBooked.value = 'Yes';
                        console.log('‚úÖ Appointment booked set to Yes');
                    }
                    if (appointmentType) {
                        appointmentType.value = 'Land Stewardship Discovery Call';
                        console.log('‚úÖ Appointment type set');
                    }
                    
                    if (e.data.payload && e.data.payload.event) {
                        const event = e.data.payload.event;
                        const startTime = new Date(event.start_time);
                        
                        if (appointmentDate) {
                            appointmentDate.value = startTime.toLocaleDateString('en-US', {
                                weekday: 'long',
                                year: 'numeric',
                                month: 'long',
                                day: 'numeric'
                            });
                            console.log('‚úÖ Appointment date set:', appointmentDate.value);
                        }
                        
                        if (appointmentTime) {
                            appointmentTime.value = startTime.toLocaleTimeString('en-US', {
                                hour: 'numeric',
                                minute: '2-digit',
                                timeZoneName: 'short'
                            });
                            console.log('‚úÖ Appointment time set:', appointmentTime.value);
                        }
                        
                        if (appointmentInfo) {
                            const info = [];
                            if (event.name) info.push(`Event: ${event.name}`);
                            if (event.duration) info.push(`Duration: ${event.duration} minutes`);
                            if (event.location) info.push(`Location: ${event.location}`);
                            appointmentInfo.value = info.join(' | ');
                            console.log('‚úÖ Appointment info set:', appointmentInfo.value);
                        }
                    }
                    
                    callScheduledField.value = 'true';
                    callScheduledStatus.style.display = 'block';
                    callScheduledStatus.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    console.log('‚úÖ Call scheduled field set to true');
                });
                console.log('‚úÖ Calendly event listener initialized');
            } else {
                console.log('‚ö†Ô∏è Calendly not available for listener initialization');
            }
        }
    </script>
</body>
</html>
